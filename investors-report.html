<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Investor Report</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="report">
    <h1 id="report-title">Investor Report</h1>
    <p id="report-date"></p>
    <table id="report-table">
      <thead>
        <tr>
          <th>Vendor Name</th>
          <th>Packs Sold</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be added here -->
      </tbody>
    </table>
    <p id="total-packs"></p>
    <p id="total-cut"></p>
    <button onclick="window.print()">Print/Save as PDF</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabase = Supabase.createClient('your-supabase-url', 'your-supabase-key');
    const urlParams = new URLSearchParams(window.location.search);
    const investorId = urlParams.get('id');

    async function fetchReportData() {
      const { data: investor, error: investorError } = await supabase
        .from('investors')
        .select('name')
        .eq('id', investorId)
        .single();
      if (investorError) {
        console.error('Error fetching investor:', investorError);
        return;
      }
      document.getElementById('report-title').textContent = `Investor Report: ${investor.name}`;
      document.getElementById('report-date').textContent = `Date: ${new Date().toLocaleDateString()}`;

      const { data: vendors, error: vendorsError } = await supabase
        .from('vendors')
        .select('name, packs_sold')
        .eq('investor_id', investorId);
      if (vendorsError) {
        console.error('Error fetching vendors:', vendorsError);
        return;
      }
      const tbody = document.querySelector('#report-table tbody');
      let totalPacks = 0;
      vendors.forEach(vendor => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${vendor.name}</td><td>${vendor.packs_sold}</td>`;
        tbody.appendChild(row);
        totalPacks += vendor.packs_sold;
      });
      document.getElementById('total-packs').textContent = `Total Packs Sold: ${totalPacks}`;
      const totalCut = (totalPacks * 13.50).toFixed(2);
      document.getElementById('total-cut').textContent = `Total Cut: $${totalCut}`;
    }

    fetchReportData();
  </script>
</body>
</html>